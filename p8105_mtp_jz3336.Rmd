---
title: "Midterm Project"
author: Jiayi Zhou
output: github_document
---

```{r setup, include = FALSE}
library(tidyverse)
library(readxl)

knitr::opts_chunk$set(
  message = FALSE,
  warning = FALSE,
  fig.width = 6,
  fig.asp = .6,
  out.width = "90%"
)

theme_set(theme_minimal() + theme(legend.position = "bottom"))

options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)

scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d

```

## Problem 1: Data

**Description on the raw dataset**:
The dog weights raw dataset has six variables. The first column contains the date of each weighing from August 12nd, 2018 to September 7th, 2020, while some dates in this period were not recorded. The second to fifth columns contain information about the weights of three dogs and a standard object: Raisin, Simon, Gagne, and std. All weights were recorded in the combination of Lbs and Oz. The last column contains occasional notes about kennel. 

**First dataframe about dog weights**
```{r}
dogweights_df =
  read_excel("./data/dogweights_07sept2020.xlsx", skip = 1) %>% 
  janitor::clean_names() %>%
  mutate(date = as.numeric(date),
         date = janitor::excel_numeric_to_date(date)) %>% 
  select(-x6) %>% 
  pivot_longer(
    raisin:std,
    names_to = "dognames_and_std",
    values_to = "weights"
  ) %>% 
  separate(weights, into = c("Lbs", "Oz"), sep = " ") %>% 
  mutate(
    Lbs = as.numeric(Lbs),
    Oz = as.numeric(Oz),
    weights_in_lbs = Lbs + Oz * 0.0625
    ) %>% 
  drop_na(weights_in_lbs, date) %>% 
  select(-Lbs, -Oz)

dogweights_df
```

**Descriptions of the steps for tidying the dogweights_df dataframe**:
First, I imported the raw excel dataset using the readxl package. After cleaning up the variable names, I noticed that the observations in "date" were shown as five digits serial numbers rather than readable dates. Thus, I first used as_numeric from mutate to transfer "date" from a character variable to numeric variable, then the excel_numeric_to_date from the janitor package was used to convert the serial number observations to date class. For better readability and convenient filtering that might take place in the future, I further separate "date" into "year", "month", and "day". Next, I put all dog names and the "std" representing standard objects into the "dognames_and_std" columns since they are all names. The weights associated with each name on each day were also converted to Lbs and then organized into "weights_in_Lbs" columns. To convert the weight unit, separation of the weight in Lbs and weights in Oz was done first. Then, weights in Oz times the coefficient 0.0625 was added back to Lbs to get the total weight in single unit Lbs. Furthermore, the missing value in the new variable "weights_in_Lbs" can be dropped without interfering other useful observations. There were also several NAs in the three date-related variables resulted from an "s" entry in "date" in the raw dataset. Thus, I chose to drop all missing values in "year" which helped me to leave out all NAs associated with the "s" entry.


**Second dataframe about notes**
```{r}
notes_df =
  read_excel("./data/dogweights_07sept2020.xlsx", skip = 1) %>% 
  janitor::clean_names() %>%
  mutate(date = as.numeric(date),
         date = janitor::excel_numeric_to_date(date)) %>% 
  rename(note = x6) %>% 
  select(date, note) %>% 
  drop_na(date, note)

notes_df
```

**Export the two dataframes as CSVs**
```{r}
write.csv(dogweights_df, "./data/dogweights.csv")
write.csv(notes_df, "./data/notes.csv")
```

## Problem 2: EDA

**Description of the cleaned dogweights_df dataset**:
The tidy dataset now is consists of `r ncol(dogweights_df)` variables and `r nrow(dogweights_df)` observations. The variables are "year", "month", "day", "dognames_and_std", and "weights_in_Lbs". The "note" column in the raw dataset was omitted.

**Unique dates**
```{r}
unique_dates=
  dogweights_df %>% 
  distinct(date) %>% 
  nrow()

unique_dates
```
The number of unique dates in the tidy dog-weights dataset is `r unique_dates`. This number of unique dates is less than the number of unique dates in the raw dataset, because the tidy dataset has omitted dates with no weight records associated and dates that cannot be converted to readable names, such as "s".


**Table showing the dog names with their associate number of observation, average weight, and the standard deviation:**
```{r}
dogweights_df %>% 
  filter(dognames_and_std %in% c("raisin", "simone", "gagne")) %>% 
  group_by(dognames_and_std) %>%
  rename(dognames = dognames_and_std) %>% 
  summarize(
    number_of_obs = n(),
    average_weight = mean(weights_in_lbs),
    sd_of_weight = sd(weights_in_lbs)
  ) %>% 
   knitr::kable()
```


## Problem 3: Visualization

```{r}
dogweights_df %>% 
  filter(dognames_and_std %in% c("raisin", "simone", "gagne")) %>% 
  group_by(dognames_and_std) %>% 
  rename(dognames = dognames_and_std) %>% 
  mutate(
    dognames = factor(dognames, levels = c("gagne", "simone", "raisin"))
    ) %>% 
  ggplot(aes(x = dognames, y = weights_in_lbs)) +
  geom_boxplot(aes(color = dognames)) +
  labs(
    tittle = "The distribution of weights for each dog",
    x = "Dog names",
    y = "Weight (Lbs)"
  )
```





